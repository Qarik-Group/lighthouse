#!/usr/bin/env bash

set -eux

# Generate the certificat file for BOSH_CA_CERT

cat <(bosh int <(safe get secret/xjkevin/bosh/ssl/ca) --path /certificate) > certs/bosh-ssl.crt

# Set static configuration and configuration from safe here

  BOSH_ENVIRONMENT="10.200.195.1"
      BOSH_CA_CERT=certs/bosh-ssl.crt
       BOSH_CLIENT="admin"
BOSH_CLIENT_SECRET=$(bosh int <(safe get secret/xjkevin/bosh/users/admin) --path /password)

# Create an alias

bosh alias-env bosh-env -e ${BOSH_ENVIRONMENT} --ca-cert ${BOSH_CA_CERT}

# Log into BOSH_ENVIRONMENT

bosh login -e bosh-env --client=${BOSH_CLIENT} --client-secret=${BOSH_CLIENT_SECRET}
